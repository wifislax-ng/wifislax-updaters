#!/bin/sh

# Script by www.seguridadwireless.net

SCRIPT_VERSION=20160414

############################################################
## Funciones comunes. Su nombre empieza por f_ ##
############################################################
f_variables(){
	. /opt/wifislax-updaters/Funciones/funciones_updater
}

############################################################
## Funciones propias del script. Su nombre empieza por F_ ##
############################################################
# Definicion de variables
F_variables() {
	PRGNAM=facebook_hack_tool
	echo -ne "\033]2;${PRGNAM}_updater\007"
	WEB=https://github.com/chinoogawa/fbht/releases
	VERSION=`curl -s $WEB | grep tree | head -1 | cut -d "/" -f5 | cut -d '"' -f-1 | rev | sed "s/.$//g" | rev`
}

# Creamos directorios extra
F_extradirs(){
mkdir -p $PKG/usr/share/{pixmaps,applications/wifislax/Testing} $PKG/opt
}

# Comprobar dependencias
F_dependencias(){
DEPENDENCIAS="matplotlib mechanize simplejson networkx decorator python-dateutil six selenium"
f_dependencias
}

# Si el paquete no existe se descargara de internet
F_download(){
	if [ ! -d $TMP/fbht  ]; then
	echo 
	echo "$CYAN"Descargando sources de $PRGNAM-$VERSION"$CIERRE"
	sleep 1
	git clone https://github.com/chinoogawa/fbht
	fi
}

# Descomprimimos el fichero descargado y compilamos
F_compilar(){
echo 
echo "$VERDE"Creando paquete ..."$CIERRE"
sleep 1
cp -rf $TMP/fbht $PKG/opt
rm -rf $PKG/opt/fbht/.git

# Creamos el icono
echo "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
SUVORK5CYII=" | base64 -d > $PKG/usr/share/pixmaps/$PRGNAM.png

# Creamos el fichero desktop
echo "[Desktop Entry]
Categories=testing;
Exec=python /opt/fbht/main.py
GenericName=Facebook hack tool
Icon=$PRGNAM
MimeType=
Name=Fbht
StartupNotify=true
Path=/opt/fbht
Terminal=true
TerminalOptions=
Type=Application" > $PKG/usr/share/applications/wifislax/Testing/$PRGNAM.desktop
}

###################################
## BLOQUE PRINCIPAL DE EJECUCION ##
###################################
# Si se cierra el script inesperadamente, ejecutar la funcion de limpieza
trap f_exitmode SIGHUP SIGINT

#Inicializamos las variables globales
f_variables
#Comprobamos conexion a Internet
f_comprobarConexion
#Inicializamos las variables del script
F_variables
#Creamos directorio de trabajo
f_directorioTemporal
#Creamos directorios extra
F_extradirs
#Mostramos el mensaje de presentacion
f_presentacion
#Comprobamos updates del script
f_comprobarUpdates
#Asignamos o detectamos arquitectura
f_arquitectura
#Comprobamos version instalada del paquete
f_versionInstalada
#Compronar dependencias
F_dependencias
#Si no existe el fichero se descargara
F_download
#Descomprimir fichero descargado y compilamos
F_compilar
#Hacemos strip sobre el paquete
f_strip
#Creamos xzm , instalamos y salimos
f_tareasFinales