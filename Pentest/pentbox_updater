#!/bin/sh

# Script by www.seguridadwireless.net

SCRIPT_VERSION=20160211

############################################################
## Funciones comunes. Su nombre empieza por f_ ##
############################################################
f_variables(){
	. /opt/wifislax-updaters/Funciones/funciones_updater
}

############################################################
## Funciones propias del script. Su nombre empieza por F_ ##
############################################################
# Definicion de variables
F_variables() {
	PRGNAM=pentbox
	echo -ne "\033]2;${PRGNAM}_updater\007"
	WEB=https://sourceforge.net/projects/pentbox18realised/files/
	VERSION=`curl -s $WEB | grep -i "click to download pentbox" | cut -d "-" -f 2 | cut -d "." -f-2`
}

# Creamos directorios extra
F_extradirs(){
mkdir -p $PKG/{opt/$PRGNAM,usr/bin} $PKG/usr/share/{pixmaps,applications/wifislax/Testing}
}

# Comprobar dependencias
F_dependencias(){
DEPENDENCIAS="ruby"
f_dependencias
}

# Si el paquete no existe se descargara de internet
F_download(){
	if [ ! -f $PRGNAM-$VERSION.tar.gz ]; then
	echo ""
	echo "$CYAN"Descargando sources de $PRGNAM-$VERSION"$CIERRE"
	sleep 1
	aria2c -x 3 $WEB/$PRGNAM-$VERSION.tar.gz
	fi
}

# Descomprimimos el fichero descargado y compilamos
F_compilar(){
echo ""
echo "$VERDE"Descomprimiendo ..."$CIERRE"
sleep 1
rm -rf $PRGNAM-$VERSION
tar xvf $PRGNAM-$VERSION.tar.gz
cd $PRGNAM-$VERSION
cp -Rf ./* $PKG/opt/$PRGNAM

# Creamos un pequeÃ±o script por si se llamase la tool desde consola
echo "#!/bin/bash

clear
cd /opt/$PRGNAM
ruby ./$PRGNAM.rb" > $PKG/usr/bin/$PRGNAM
chmod 777 $PKG/usr/bin/$PRGNAM

# Generamos icono descodificandolo en base64
echo "
iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABHNCSVQICAgIfAhkiAAAAAlwSFlz
AAAOxAAADsQBlSsOGwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxMC0wMi0xMFQwMDo1MjoxOC0wNjow
MPC+HDoAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMDctMDUtMjhUMTA6MTE6NDAtMDU6MDC6pfmIAAAR
OklEQVRogbWaaZCcR33Gf939vnPt7Oyu9tZqpfVKlmVjyWshywfG4GBDwAFDAgRMqhxSOT7kS0JB
xaQqJAU2hCo+UBQUgcQhKY5AjnKCHWxjW74v+bYsSyvtalfr1d7anZmd8337yIf3ndlZxVzGdFXX
tN6Znnme//P0v//dK8FvviXHsomde/u8y/Z2Ja7a3+ld87Vjxb/68Vzw4zfjy8Wb8SWt3zeaYnis
L33Zvk7v4N5u//LtWW+fTac717Pt4my2jc5yiYEzC/a+xfoPv35M//V0rXb61/rBX2fyKHRs71MH
xrqSl1/a5V2+K5e8zO/I9NW6ulQx18FaV471jjYqArS1aG3QRrMlv86lE1P4S6vl757WX/nGZPnL
QPU3TSB9RYd/4YWd8vL9Oe+KC3sSB9O57G7X2yNr3b2s92yhMpCjriTWOqy1GGtwxmKMJbAaExoC
rbHGEOiQ7XOrjE2dYjVfnvnGlL7lztnajwD7ZhCQezsYGU35l12Y4/KxjsQVA71dF4v+vqwb6BfB
1n7CgS7CTALnYrDONoFba6OIW4M1FmN0FH2tCeJXoyMShJo9U3NccPq0ezmvn/zaVP0vX1rVh38V
Aurj29T7l+pKjSbs7ks61RXn9W85mBns61ND26QdHsRs64VsEiPAOQc4nIvGzjmMsxjnYgImJuEw
RhNYi9UarTWhNmgdNknoUBPoiFyqUueSiWm2zs7pe4ryB7e/Ur5lBuZ/IYGP9Ms/urnT3i4ltN/4
ftQ1ByCXxglwzsZAbRRpGmMR/9s134s6TQVCZzDGYLUlNLoZfaNDwiZwTRhqwvjVhIaO/DoHT55C
LK2Wvr/IF//lteCr/Jz1oa7qTt/Q7+nf8qXAnDqFn+kgcf4OpCeRstEFUnoIKZFSNZ+ruCNbPytB
RZ8T8VwhJEIIpJAgBEgRvSBwAiQg4nEl4XO8r4daWzZxg1t/1w05e9NZ581NVcyx1yUw1uldt+26
sXeUSzUSgUacOI6Zmif5louQ6QRCbAAT5wCVMaFWIkIKhGwAFkipQEZjIQAhUUSkkCCEiEgJgUAA
AicE+bYkx7f2kfW8ro9S+PBYTr5zJrQvLddZ2EygK3H1tn07rq1edgG6ahD5KpnSOrUnDpMYGsXr
74wBReBkiwpCSFwMvFUJJSVSCGhGHhAiUlLIWAER424Zy4iEQoAAKwTzne1MDPaLXSYc+Zgo/0lP
Wg0rRNlKFxQ16+r8jsSB0b1D7zGdGdzoIDqXo356gY5MhuCJR5EmQWLPKFIpZEyiaQkpUUKihMJt
spvExcAkAis2LENMRjWBxz1WLZrnNp4DoVKs5tqwTsiry2v792fczR8aTP/hSk0eV/l6OPtWF763
fbivx2WSyP4u2LmD8sRpspl21KkJguNTJPdciMgkkCKKsJAChMKLSakYVBR1iYy7a9hDRD6PLBON
EcRWEqiGSjHwpIPeuVVGJl/j4qMT7Dl2ilx+nZKTrBtHJZlLZ7wwodY1xZ6kGNtfr+9PpRLo7hwq
m8Eb20NlMQ/rVdqdo/LwQyT6z0MNbomsE/8QLZ4njr6I7SKEbIKOXtmYBzghY9eD5xy5M2v0HJtk
+IWjjD7zEn2zC2TLAUHoWHUeKxpeS6XId2S5ujPHi8XaMx6AVLLwwvbd7Jpeon+9SuHgRaikj/+h
txMcmWHu0GNs7e6h+s/fJnHt9SQ/eC1SKQCkA4NDOkcASBxKCIyTCGGj/NJiFRfbSjhIL6zhTUzj
T0+TmJ9HGSDdTs0KiqkuSpUqa8ay1pnlbFc7K+0pytawtVAj6XyEkDUPwMcWzuvr5HRXO4Uzy1x8
6DnW33MlnvTwD+xBjAwx9+930ZPJ4Z54mOrMJOlP/AGuPxtFD4GV4DsAh0VgnYtsEUfeCoG/WiZ1
fAJxahJ1egqvVsfLdaOlR7m9j/x6icJ6iUJHjuJAN6s97RQkLXuFQTiL5yxOW+brrqYALupKXXb9
9Ze9O721m7MJn5maz44XXiQxtBXZ2Ya3pZ30wUspzZ1FLy/TFlSpP/Uk/pZh3NbuOONE2RAaixG8
Qg15ZBL1xGES99xL6pGHSc8vkKxrnJeiJBIsFfIsJHwW+3tY3DfK3L6drG7rYb0jQ10KjLM4G+32
1jmccXRXa/TnKzxUFN/zomQqi2kJQ9u6yWbTTGfSPJlOcfFPHmfw7fsx+3aiUj5dN3+A2mM7Wbr7
LrpTPsF3v4U3fT3qxutQnsRVQ+yJWZgYx58+iVyeQ0of4SXQTlBNZCmtV6hmPcJtQwTDA1QGO6kY
TS0ICIIAUQ8Qr5OltmhH70qRdL6Ct17jzjLu1YL4Hw/AClUQWuNLSU9PB5lMmpn2NK+mfFYfP8ol
a0XsdZcjpaL9HZeSOW8Hq9/7Pu1BHfXovZiZSWTShzPTqFCjPIUTikD6lKp1amkPM7QDM7IdvXOQ
alJhQ02gQ0wYIq2NU3O0WSoBUjgGzhZJz5+lXgpZ1pLxTJbVjhxtYZFcft4tr1bKHsBisV7CGJwE
JSUdHRnOz2wll8twsj3FQ69Mc/Xq3fi/+z5kNoG3q5+Bz/4Fa9+/g/DIs/TOTuIpgXaCunUEKoHZ
OgI7RmH3CPS1gzEYrdEmRIS6GVklBKGUJIH2lRL+6XnKy3kKJc3JVBurHX2EGXAClBJ0JBU7pGFb
4Jt/hNADqGhbQRvAxR0yySTDw71ks2lOZjPcd2SGK7/zHwx+5EbEUA+yzaf3z25i8UsrmMI8RT+D
v/8K5Pm7SI4OoD2JtlFBhwlxNsr1Wgg8IQiFIF2o0DbxGsXTcyyvlDnlEqx05Ah7h1ADCuVLOhOK
ZFKRSCp8XyI9yegZw0DerwHGAxDSKxKGzrk4v8UtoTz6+jpJp9JMt2V48mgbe753Bxe/713IS3cj
lEAlkqi2TmRvP6kPvRvtDM5ZhDHxLgySKKV6ocE7PkPp5DQrs0vMVQyL2U5Mdy/elq34SY+epE86
pfCTHl5C4XkCIYmr46hUzy5KPKVqNBQIvVrB2SgFYuLkHjcpJZ1dbexJDZPLtfFqR5rlnzzCNYuL
JH/nHQilEMoDY7HCRVWli+0RGtzUPLXxCeZOzTK7XGA+0U7Qv4Xkzt1kMgkG0x6pVIIw1ExPzpNI
eGwf7YO4VDfWtByIwOGQ1qKVV20qMP1aveq0dlgnnB/V9VGLBgJBJpNiZKSftlya451t3Hn4Vd61
+J8IozGlAi7bgQLMbB49fpK5k5NMziwxqxW1nm5SA8Pk9uxhe1uSdNrH8yRnzpzlyPOnePnFaaam
FglDwxVv28PYW0fQOiQ0UUCjQ5PDxIcoaQyrVV0DnAeQhLqr1zWQwLhYAUfzxCkcKEhIn8G+bjLJ
FJMdbdz92DFGJmfYlwqYGz9B6bZvMl00rGS7SGzrpuuqHezsbCOTSZLKJEgmPU4cn+UH//U4r7w0
RT5f3lTb92/Zwns/cCWNEx/xYQkLonFosiCdQ0tVBfAA3CBVW6tr4VzCScBGgJ2MKZiGn0AlBFu2
tJNqO49cro3HJsZ54dQ0Qkq2X7uX4R29XNCeJp1OkEn6SF8hPYEnoBZqvnTrv7G2FgFPJ5OM7d/N
gQMXcMn+8+gZbKdWKxBoHYN1GGxTAeFcZCEHRnrFJoH5eWomDAIPMhiH8yOpBI5IkVZLRf7OplPs
HNlKuL2bUnkOTwmGL9lFcqiThIp2YyssxoGwhtAahBbs23cBPUO9XHlwNxdcOITyQkITYowmDEub
jqg4h7SOoHlktU1cVsgNAoAtl2v1Dlxkl1iBaEE3lIgtZeJZVpBMJujvSDHUlWI90HR1ZfHaUuj4
pkJYh3IWC0gn8H3FF/7+ExijMcagbRilWdymc3UrWOccYtO52yGd4HS+XolNEbewVsJGHmvaqNni
sWHzMwW+8mlPJ5Dx6ar57kYmiCxA4zbDEhV8UQXbAM85IBvdxp+N7BMvYiGw2M0EbD0sRIeP+Eub
WFqItOwRqPiRkkgvCc3KvgEsWmw2Lrc3SDWynMPAOZFvJdFYwJvVES5Oo7jiJgL5UqnYjLppKLAZ
fESq8UwgrIv2AT/ZEm2BAVQMULpo0W2QiqPY7Lxu5Dn3ORuKCGsxVmwmsJKvVpyLF62NZMYS9Tgf
N1vLWEiF9H1Ei2Wkc8390MaEGxYysarWCQwNT9tNKohz7poi4aKBcA6MYX6tXN5EwDlTQhucdLi4
no/666wFHMI6nBSRAp4fPW25qJQtnEW8tcjGoiTqsnk51rpoaWagxlg0xkSXa2hN3YnNBGbX7Wvi
tcXIOo1M1GKhVnCtKggpEX6iCZSWiIs46ra5gBvRh9fPPJu7cI35NP3vHDitcUpuspD86ksrPzp0
+x3j4vgMzbqo9Z64Md6UnSILCenH30Jkt5aF3LBWIxNJF6XkcxeuOEcFWtRpLORGcJw2VAOTbyVg
NZz8/FOLt937nTtOyBfHNxZTHD0hNgN38UyhJCgPhMDFe0ZjOQgXS95iPYNDxBG3P0eFxnsN9WhV
QYcsVcMybGxkAPkQ7rz18LJx7q7P3RjqC3jbpc3IOwHCNnblOLrWgZIIT52jTkt+j6Mvl9ZpOz6O
qJQovu0ATjSi26rCZhIiftbYB5pW1AZEogj1lo1sg8RdX3hm6W/u+OE9x+SDTzvM5vTpBE3/R2Wz
AruRljYkF4iaxn/2GN7EPG333Us4vA2ExJ84E1nLnquCa1quAbxBjFi5rmIFT2u3qqsWEK0KNFrR
wN23PbNkNQ9/7qZA73U3vFPQuC60Lq7wYmspiTO6OVnM5RFHj6GmTxJcdQ3+S89Tv+kj2OczhMPd
+OMO3d0R28FuVJnNK/zNu7JwjlyhwuD8AkPLyyTLJV4u2urCmt0PTL0eAYCSgXu//My8Nu7xv/uk
0WPmhusgpSLTNZyiQAiF0zqy1vQC4sw0ZmQUUSpidg2gnm0HXyArJdrvepB6fz9hdxan9aYIu2bE
IxUz6xV6T59h6/ISqXKJs9XQHS7YhUNL4WOPLFb+u2rt00DxZxFokLjvK8/O1zWHb/3jWnU/N94g
6MxsKrOFp3A6iGaMDGAv3oG8/3H0gf20Lj6XTFJ67zWEzkZp8JzIC+dI5yt0Tc3Qt7RAulRhtabd
c8Vg5YEzlaeeWq7/73RRPwbMAqWGkX8eAYCKgYe++uzcLfUw/PyfVypX8OHfE/TlmlWpUAoXBhsz
ChUIQ+xAjuiiILKb87xog7Sb6x9/rULX5DTdi/OkK1XWqtodyVfXHpgpPvv4UnDPRCF4BJgGCoA+
F+AvIgBQM/Do119aviUw3Pqp+nffLn7/Jhjsjt6VEheGEUwB6snD6INvjTLSeg2ZX0GNz1LbO9a0
jFyvkjs6SeeZGTJBSKGqGc9X1n86dfa5Rxdq903mg4c1TAKrQMiGaf9f+2UIANSBJ7/9yvJnjNFf
/FTtn65NfPRmwc4hhBLYsA4IxEoRsbSAeuQxZFAnGBujcuMH0d1t2NUy6aeP0jZ9itR6gaIW7uR6
WL5/YunlR5dqDxw5W38AmADOxr/3M0G/EQIQReK524+tfVpbe9tn6v/w26mPflIgFS6sR6luaQl7
4cXo80cw7T72bBn16gnafnocf2WJUmCZrNrqoZn8kUfm64deXakeqsMJYAmo/bKg3ygBiDz48r+O
Fz6trat/NvzWjeqi/cKaaA24i3ZGO+3L46SPH8GbO02pppkORPDQQuXoQ/O1B19crN4fwPEYdJVf
8Q/b57Y3+l8NJLDjYzvbb/307sTH0wpxNhD0X/QWxMxJyrU684EMHl/Rrz60VH/whcXKvRXDOLD8
ZoB+Mwg05vZ/Ymf73352d/JPV0Mjq06ET6/ao4eWwvufX6j9tGjMOLBCZI83DfS5IH7dlru0y3/f
UNYfeXo5eHS5pk8ARSDgDXj6V23/BxTsgzlT5p+/AAAAAElFTkSuQmCC

" | base64 -d >/$PKG/usr/share/pixmaps/$PRGNAM.png 

# Finalmente , la entrada al menu
echo "[Desktop Entry]
Categories=testing;
Exec=$PRGNAM
Name=Pentbox
Icon=$PRGNAM
StartupNotify=true
Terminal=true
Type=Application" > $PKG/usr/share/applications/wifislax/Testing/$PRGNAM.desktop
}

###################################
## BLOQUE PRINCIPAL DE EJECUCION ##
###################################
# Si se cierra el script inesperadamente, ejecutar la funcion de limpieza
trap f_exitmode SIGHUP SIGINT

#Inicializamos las variables globales
f_variables
#Comprobamos conexion a Internet
f_comprobarConexion
#Inicializamos las variables del script
F_variables
#Creamos directorio de trabajo
f_directorioTemporal
# Creamos directorios extra
F_extradirs
#Mostramos el mensaje de presentacion
f_presentacion
#Comprobamos updates del script
f_comprobarUpdates
#Asignamos o detectamos arquitectura
f_arquitectura
#Comprobamos version instalada del script
f_versionInstalada
#Compronar dependencias
F_dependencias
#Si no existe el fichero se descargara
F_download
#Descomprimir fichero descargado y compilamos
F_compilar
#Hacemos strip sobre el paquete
f_strip
#Creamos xzm , instalamos y salimos
f_tareasFinales