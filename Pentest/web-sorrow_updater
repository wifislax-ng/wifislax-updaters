#!/bin/sh

# Script by www.seguridadwireless.net

SCRIPT_VERSION=20151116

############################################################
## Funciones comunes. Su nombre empieza por f_ ##
############################################################
f_variables(){
	. /opt/wifislax-updaters/Funciones/funciones_updater
}

############################################################
## Funciones propias del script. Su nombre empieza por F_ ##
############################################################
# Definicion de variables
F_variables() {
	VERSION=1.5
	PRGNAM=web-sorrow
	echo -ne "\033]2;${PRGNAM}_updater\007"
	DOWNLOAD=https://web-sorrow.googlecode.com/files/Web-Sorrow_v1.5.0FINAL%28patched_version%29.zip
}

# Creamos directorios extra
F_extradirs(){
mkdir -p $PKG/opt/$PRGNAM $PKG/usr/share/{pixmaps,applications/wifislax/Testing}
}

# Si el paquete no existe se descargara de internet
F_download(){
	if [ ! -f 'Web-Sorrow_v1.5.0FINAL(patched_version).zip' ]; then
	echo 
	echo "$CYAN"Descargando sources de $PRGNAM-$VERSION"$CIERRE"
	sleep 1
	aria2c -x 3 $DOWNLOAD
	fi
}

# Descomprimimos el fichero descargado y compilamos
F_compilar(){
echo 
echo "$VERDE"Descomprimiendo ..."$CIERRE"
sleep 1
unzip $TMP/'Web-Sorrow_v1.5.0FINAL(patched_version).zip' -d $PKG/opt/$PRGNAM

# Creamos el icono
echo "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" | base64 -d > $PKG/usr/share/pixmaps/$PRGNAM.png

# Creamos el dektop 
echo "[Desktop Entry]
Categories=testing;
Exec=sh -c "'"perl /opt/web-sorrow/Wsorrow.pl;${SHELL:-bash}"'"
Icon=$PRGNAM
MimeType=
Name=Web-sorrow
Path=/opt/$PRGNAM
StartupNotify=true
Terminal=true
TerminalOptions=
Type=Application" > $PKG/usr/share/applications/wifislax/Testing/$PRGNAM.desktop
}

###################################
## BLOQUE PRINCIPAL DE EJECUCION ##
###################################
# Si se cierra el script inesperadamente, ejecutar la funcion de limpieza
trap f_exitmode SIGHUP SIGINT

#Inicializamos las variables globales
f_variables
#Comprobamos conexion a Internet
f_comprobarConexion
#Inicializamos las variables del script
F_variables
#Creamos directorio de trabajo
f_directorioTemporal
#Creamos directorios extra
F_extradirs
#Mostramos el mensaje de presentacion
f_presentacion
#Comprobamos updates del script
f_comprobarUpdates
#Asignamos o detectamos arquitectura
f_arquitectura
#Comprobamos version instalada del paquete
f_versionInstalada
#Si no existe el fichero se descargara
F_download
#Descomprimir fichero descargado y compilamos
F_compilar
#Hacemos strip sobre el paquete
f_strip
#Creamos xzm , instalamos y salimos
f_tareasFinales